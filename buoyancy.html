<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Archimedes Physics Simulators</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    /* Root variables for consistent styling */
    :root {
      --primary-color: #007bff; /* Blue */
      --secondary-color: #28a745; /* Green */
      --accent-color: #ffc107; /* Yellow */
      --dark-color: #343a40;
      --light-color: #f8f9fa;
      --background-gradient: linear-gradient(135deg, #e0f2f7 0%, #c2e0f0 100%);
      --panel-bg: #ffffff;
      --border-radius: 12px;
      --box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15);
      --input-bg: #e9ecef;
      --button-hover-scale: 1.03;
      --button-active-scale: 0.98;
    }

    /* Global reset and body styling */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--background-gradient);
      color: var(--dark-color);
      line-height: 1.6;
      padding: 25px;
      display: flex;
      justify-content: center;
      align-items: flex-start; /* Align to top */
      min-height: 100vh;
    }

    /* Main container for the application */
    .container {
      width: 100%;
      max-width: 1300px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 25px;
    }

    /* Header styling */
    header {
      text-align: center;
      padding: 25px;
      background: var(--panel-bg);
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }

    h1 {
      color: var(--primary-color);
      margin-bottom: 12px;
      font-size: 2.8rem;
      letter-spacing: -0.5px;
    }

    .subtitle {
      color: #6c757d;
      font-size: 1.3rem;
    }

    /* Tab navigation styling */
    .tabs {
      display: flex;
      justify-content: center;
      margin-bottom: 25px;
      flex-wrap: wrap;
      gap: 12px;
    }

    .tab-btn {
      padding: 14px 28px;
      background: var(--panel-bg);
      border: none;
      border-radius: 30px;
      font-size: 1.05rem;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      font-weight: 600;
      color: var(--dark-color);
      flex-shrink: 0;
    }

    .tab-btn:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    .tab-btn.active {
      background: var(--primary-color);
      color: white;
      box-shadow: 0 5px 15px rgba(0, 123, 255, 0.4);
    }

    /* Tab content styling */
    .tab-content {
      display: none;
      background: var(--panel-bg);
      padding: 35px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
    }

    .tab-content.active {
      display: block;
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(15px); }
      to { opacity: 1; transform: translateY(0); }
    }

    /* Simulation area styling */
    .simulation-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 25px;
    }

    .simulation-title {
      color: var(--primary-color);
      font-size: 2.2rem;
      text-align: center;
      margin-bottom: 10px;
    }

    .controls {
      width: 100%;
      max-width: 900px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 25px;
      padding: 20px;
      border-radius: var(--border-radius);
      background: var(--input-bg);
      box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    .control-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .control-group label {
      font-weight: 600;
      color: #555;
      font-size: 1rem;
    }

    .control-group input[type="number"],
    .control-group select {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 1rem;
      background: white;
      box-shadow: inset 0 1px 4px rgba(0,0,0,0.05);
      transition: border-color 0.3s ease;
    }

    .control-group input[type="number"]:focus,
    .control-group select:focus {
      border-color: var(--primary-color);
      outline: none;
    }

    /* Button styling */
    .button-group {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    button {
      padding: 14px 30px;
      border: none;
      border-radius: 30px;
      font-size: 1.1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 700;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    button.primary {
      background-color: var(--primary-color);
      color: white;
    }

    button.secondary {
      background-color: var(--secondary-color);
      color: white;
    }

    button:hover {
      transform: scale(var(--button-hover-scale));
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    }

    button:active {
      transform: scale(var(--button-active-scale));
    }

    /* Canvas and simulation area */
    .simulation-area {
      width: 100%;
      max-width: 900px;
      height: 550px; /* Increased height for more visual space */
      background: #f8f9fa;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--box-shadow);
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
      background: var(--panel-bg);
      border-radius: var(--border-radius);
    }

    /* Info panel styling */
    .info-panel {
      background: var(--panel-bg);
      padding: 25px;
      border-radius: var(--border-radius);
      box-shadow: var(--box-shadow);
      margin-top: 25px;
      width: 100%;
      max-width: 900px;
    }

    .info-item {
      margin-bottom: 12px;
      font-size: 1.15rem;
      line-height: 1.5;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 5px;
      border-bottom: 1px dashed #eee;
    }
    .info-item:last-child {
      margin-bottom: 0;
      border-bottom: none;
    }

    .info-item strong {
      font-weight: 700;
      color: var(--primary-color);
    }
    .info-item span {
      color: var(--dark-color);
      font-weight: 600;
    }

    /* Specific styles for Buoyancy Simulator */
    .water-level {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: rgba(0, 123, 255, 0.6); /* Semi-transparent blue */
      transition: height 0.5s ease-out;
      border-top: 2px solid var(--primary-color);
    }
    .object-in-water {
      position: absolute;
      background-color: #6c757d; /* Grey */
      border: 2px solid #343a40;
      transition: all 0.5s ease-out;
      transform-origin: bottom; /* For scaling from bottom */
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      color: white;
      text-align: center;
      overflow: hidden;
    }
    .object-in-water.floating {
      background-color: var(--secondary-color); /* Green for floating */
    }
    .object-in-water.sinking {
      background-color: #dc3545; /* Red for sinking */
    }
    .object-in-water.neutral {
      background-color: #ffc107; /* Yellow for neutral */
    }

    /* Specific styles for Fluid Displacement Simulator */
    .fluid-container {
      position: relative;
      width: 80%;
      height: 90%;
      border: 4px solid var(--dark-color);
      border-radius: var(--border-radius);
      overflow: hidden;
      background-color: #e0f2f7; /* Light blue */
    }
    .fluid-level {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: rgba(0, 123, 255, 0.6);
      transition: height 0.5s ease-out;
    }
    .displaced-object {
      position: absolute;
      background-color: #6c757d;
      border: 2px solid #343a40;
      transition: all 0.5s ease-out;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      color: white;
      text-align: center;
    }

    /* Specific styles for Torricelli's Law */
    .torricelli-tank {
      position: relative;
      width: 250px;
      height: 400px;
      border: 4px solid var(--dark-color);
      border-radius: 8px;
      overflow: hidden;
      background-color: #e0f2f7;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      align-items: center;
    }
    .torricelli-fluid {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: rgba(0, 123, 255, 0.7);
      transition: height 0.3s ease-out;
    }
    .torricelli-orifice {
      position: absolute;
      bottom: 50px; /* Fixed height from bottom for orifice */
      left: 50%;
      transform: translateX(-50%);
      width: 30px;
      height: 10px;
      background-color: var(--dark-color);
      border-radius: 2px;
      z-index: 2;
    }
    .torricelli-stream {
      position: absolute;
      background-color: rgba(0, 123, 255, 0.8);
      width: 5px; /* Represents efflux */
      height: 0px;
      bottom: 50px;
      left: 50%;
      transform: translateX(-50%);
      transform-origin: top;
      transition: height 0.1s linear, width 0.1s linear; /* Smooth stream changes */
      z-index: 1;
    }

    /* Responsive Adjustments */
    @media (max-width: 992px) {
      body {
        padding: 15px;
      }
      .container {
        gap: 15px;
      }
      header {
        padding: 20px;
      }
      h1 {
        font-size: 2.2rem;
      }
      .subtitle {
        font-size: 1.1rem;
      }
      .tabs {
        gap: 8px;
      }
      .tab-btn {
        padding: 12px 20px;
        font-size: 0.95rem;
      }
      .tab-content {
        padding: 25px;
      }
      .simulation-title {
        font-size: 1.8rem;
      }
      .controls {
        grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
        gap: 15px;
        padding: 15px;
      }
      .control-group label {
        font-size: 0.9rem;
      }
      .control-group input[type="number"],
      .control-group select {
        padding: 10px;
        font-size: 0.95rem;
      }
      button {
        padding: 12px 25px;
        font-size: 1rem;
      }
      .simulation-area {
        height: 450px;
      }
      .info-panel {
        padding: 20px;
      }
      .info-item {
        font-size: 1rem;
      }
    }

    @media (max-width: 768px) {
      .tabs {
        flex-direction: column;
        align-items: stretch;
      }
      .tab-btn {
        width: 100%;
        margin-bottom: 5px;
      }
      .controls {
        grid-template-columns: 1fr;
      }
      .simulation-area {
        height: 380px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Archimedes' Principle Simulators</h1>
      <p class="subtitle">Exploring Buoyancy, Displacement, and Density</p>
    </header>

    <div class="tabs">
      <button class="tab-btn active" data-tab="buoyancy">Buoyancy</button>
      <button class="tab-btn" data-tab="fluidDisplacement">Fluid Displacement</button>
      <button class="tab-btn" data-tab="densityCalculator">Density Calculator</button>
      <button class="tab-btn" data-tab="torricelliLaw">Torricelli's Law</button>
    </div>

    <!-- Buoyancy Tab -->
    <div id="buoyancy" class="tab-content active">
      <div class="simulation-container">
        <h2 class="simulation-title">Buoyancy Force & Floating/Sinking</h2>

        <div class="controls">
          <div class="control-group">
            <label for="objectMassBuoyancy">Object Mass (kg):</label>
            <input type="number" id="objectMassBuoyancy" min="0.1" max="100" value="10" step="0.1">
          </div>
          <div class="control-group">
            <label for="objectVolumeBuoyancy">Object Volume (m³):</label>
            <input type="number" id="objectVolumeBuoyancy" min="0.001" max="1" value="0.01" step="0.001">
          </div>
          <div class="control-group">
            <label for="fluidDensityBuoyancy">Fluid Density (kg/m³):</label>
            <input type="number" id="fluidDensityBuoyancy" min="100" max="2000" value="1000" step="10">
          </div>
        </div>

        <div class="simulation-area">
          <div class="water-level" id="buoyancyWaterLevel"></div>
          <div class="object-in-water" id="buoyancyObject"></div>
        </div>

        <div class="info-panel">
          <div class="info-item"><strong>Object Density:</strong> <span id="infoObjectDensityBuoyancy"></span></div>
          <div class="info-item"><strong>Fluid Density:</strong> <span id="infoFluidDensityBuoyancy"></span></div>
          <div class="info-item"><strong>Weight of Object:</strong> <span id="objectWeightBuoyancy"></span></div>
          <div class="info-item"><strong>Buoyant Force:</strong> <span id="buoyantForceBuoyancy"></span></div>
          <div class="info-item"><strong>Result:</strong> <span id="buoyancyResult"></span></div>
          <div class="info-item"><strong>Percentage Submerged:</strong> <span id="percentageSubmerged"></span></div>
          <div class="info-item"><strong>Percentage Above Water:</strong> <span id="percentageAboveWater"></span></div>
        </div>
      </div>
    </div>

    <!-- Fluid Displacement Tab -->
    <div id="fluidDisplacement" class="tab-content">
      <div class="simulation-container">
        <h2 class="simulation-title">Fluid Displacement & Volume</h2>

        <div class="controls">
          <div class="control-group">
            <label for="initialFluidVolume">Initial Fluid Volume (L):</label>
            <input type="number" id="initialFluidVolume" min="1" max="100" value="50" step="1">
          </div>
          <div class="control-group">
            <label for="objectVolumeDisplacement">Object Volume (cm³):</label>
            <input type="number" id="objectVolumeDisplacement" min="10" max="1000" value="100" step="10">
          </div>
        </div>

        <div class="simulation-area" style="display: flex; justify-content: center; align-items: flex-end;">
          <div class="fluid-container">
            <div class="fluid-level" id="displacementFluidLevel"></div>
            <div class="displaced-object" id="displacementObject"></div>
          </div>
        </div>

        <div class="info-panel">
          <div class="info-item"><strong>Initial Fluid Volume:</strong> <span id="infoInitialFluidVolume"></span></div>
          <div class="info-item"><strong>Object Volume:</strong> <span id="infoObjectVolumeDisplacement"></span></div>
          <div class="info-item"><strong>Displaced Fluid Volume:</strong> <span id="displacedVolume"></span></div>
          <div class="info-item"><strong>Final Fluid Volume:</strong> <span id="finalFluidVolume"></span></div>
        </div>
      </div>
    </div>

    <!-- Density Calculator Tab -->
    <div id="densityCalculator" class="tab-content">
      <div class="simulation-container">
        <h2 class="simulation-title">Density Calculator</h2>

        <div class="controls">
          <div class="control-group">
            <label for="massDensity">Mass (kg):</label>
            <input type="number" id="massDensity" min="0.1" max="1000" value="10" step="0.1">
          </div>
          <div class="control-group">
            <label for="volumeDensity">Volume (m³):</label>
            <input type="number" id="volumeDensity" min="0.0001" max="10" value="0.01" step="0.0001">
          </div>
        </div>

        <div class="info-panel">
          <div class="info-item"><strong>Mass:</strong> <span id="infoMassDensity"></span></div>
          <div class="info-item"><strong>Volume:</strong> <span id="infoVolumeDensity"></span></div>
          <div class="info-item"><strong>Calculated Density:</strong> <span id="calculatedDensity" class="density-result"></span></div>
        </div>
      </div>
    </div>

    <!-- Torricelli's Law Tab -->
    <div id="torricelliLaw" class="tab-content">
      <div class="simulation-container">
        <h2 class="simulation-title">Torricelli's Law (Efflux Velocity)</h2>

        <div class="controls">
          <div class="control-group">
            <label for="fluidHeightTorricelli">Fluid Height (h in meters):</label>
            <input type="number" id="fluidHeightTorricelli" min="0.1" max="5" value="2" step="0.1">
          </div>
          <div class="control-group">
            <label for="orificeAreaTorricelli">Orifice Area (cm²):</label>
            <input type="number" id="orificeAreaTorricelli" min="1" max="100" value="10" step="1">
          </div>
        </div>

        <div class="simulation-area" style="display: flex; justify-content: center; align-items: center;">
          <div class="torricelli-tank">
            <div class="torricelli-fluid" id="torricelliFluidLevel"></div>
            <div class="torricelli-orifice"></div>
            <div class="torricelli-stream" id="torricelliStream"></div>
          </div>
        </div>

        <div class="info-panel">
          <div class="info-item"><strong>Fluid Height (h):</strong> <span id="infoFluidHeightTorricelli"></span></div>
          <div class="info-item"><strong>Efflux Velocity (v):</strong> <span id="effluxVelocity"></span></div>
          <div class="info-item"><strong>Flow Rate (Q):</strong> <span id="flowRate"></span></div>
        </div>
      </div>
    </div>

  </div>

  <script>
    // Global variables for animation and current tab mode
    let animationId;
    let currentTabMode = 'buoyancy'; // Initial active tab

    // Constants
    const G = 9.81; // Acceleration due to gravity in m/s²

    // --- Utility Functions ---

    /**
     * Updates the info panel based on the current simulation mode and its parameters.
     */
    function updateInfoPanel() {
      // Buoyancy Info
      if (currentTabMode === 'buoyancy') {
        const objectMass = parseFloat(document.getElementById('objectMassBuoyancy').value);
        const objectVolume = parseFloat(document.getElementById('objectVolumeBuoyancy').value);
        const fluidDensity = parseFloat(document.getElementById('fluidDensityBuoyancy').value);

        const objectDensity = objectMass / objectVolume;
        const objectWeight = objectMass * G;
        const buoyantForce = fluidDensity * objectVolume * G; // F_B = rho_fluid * V_displaced * g (assuming fully submerged for max force)

        let resultText = '';
        let objectClass = '';
        let percentageSubmerged = 0;
        let percentageAboveWater = 0;

        if (objectDensity < fluidDensity) {
          resultText = 'Floats';
          objectClass = 'floating';
          const submergedRatio = objectDensity / fluidDensity;
          percentageSubmerged = submergedRatio * 100;
          percentageAboveWater = (1 - submergedRatio) * 100;
        } else if (objectDensity > fluidDensity) {
          resultText = 'Sinks';
          objectClass = 'sinking';
          percentageSubmerged = 100;
          percentageAboveWater = 0;
        } else {
          resultText = 'Neutral Buoyancy';
          objectClass = 'neutral';
          percentageSubmerged = 100;
          percentageAboveWater = 0;
        }

        document.getElementById('infoObjectDensityBuoyancy').textContent = `${objectDensity.toFixed(2)} kg/m³`;
        document.getElementById('infoFluidDensityBuoyancy').textContent = `${fluidDensity.toFixed(0)} kg/m³`;
        document.getElementById('objectWeightBuoyancy').textContent = `${objectWeight.toFixed(2)} N`;
        document.getElementById('buoyantForceBuoyancy').textContent = `${buoyantForce.toFixed(2)} N`;
        document.getElementById('buoyancyResult').textContent = resultText;
        document.getElementById('percentageSubmerged').textContent = `${percentageSubmerged.toFixed(2)} %`;
        document.getElementById('percentageAboveWater').textContent = `${percentageAboveWater.toFixed(2)} %`;

        // Update object visual
        const buoyancyObject = document.getElementById('buoyancyObject');
        buoyancyObject.className = `object-in-water ${objectClass}`;
        buoyancyObject.textContent = resultText; // Display result on the object itself

        // Calculate submerged height for visual
        const simulationArea = document.getElementById('buoyancy').querySelector('.simulation-area');
        const waterLevelDiv = document.getElementById('buoyancyWaterLevel');
        const simHeight = simulationArea.offsetHeight;
        const simWidth = simulationArea.offsetWidth;

        // Scale object dimensions for visual representation
        const objectVisualHeight = Math.min(objectVolume * 100, simHeight * 0.5); // Max 50% of sim height
        const objectVisualWidth = Math.min(objectVolume * 100, simWidth * 0.3); // Max 30% of sim width
        buoyancyObject.style.width = `${objectVisualWidth}px`;
        buoyancyObject.style.height = `${objectVisualHeight}px`;
        buoyancyObject.style.left = `${(simWidth - objectVisualWidth) / 2}px`;

        // Adjust object position based on buoyancy
        if (objectClass === 'sinking') {
            buoyancyObject.style.bottom = '0px'; // Sinks to the bottom
        } else if (objectClass === 'floating') {
            // Calculate how much is submerged based on densities
            const submergedRatio = objectDensity / fluidDensity;
            // Position the object such that the correct percentage is submerged
            // The water level is at 50% of the simulation area height.
            // The object's bottom needs to be at waterLevelHeight - (objectVisualHeight * submergedRatio)
            const waterLevelHeight = simHeight * 0.5;
            const finalBottom = waterLevelHeight - (objectVisualHeight * submergedRatio);
            buoyancyObject.style.bottom = `${finalBottom}px`;
        } else { // Neutral buoyancy
            // For neutral buoyancy, the object is fully submerged but not necessarily at the very bottom.
            // We can place it at the water level minus its full height.
            const waterLevelHeight = simHeight * 0.5;
            const finalBottom = waterLevelHeight - objectVisualHeight;
            buoyancyObject.style.bottom = `${finalBottom}px`;
        }

        // Water level
        waterLevelDiv.style.height = `${simHeight * 0.5}px`; // Fixed water level for simplicity
      }
      // Fluid Displacement Info
      else if (currentTabMode === 'fluidDisplacement') {
        const initialFluidVolumeL = parseFloat(document.getElementById('initialFluidVolume').value);
        const objectVolumeCM3 = parseFloat(document.getElementById('objectVolumeDisplacement').value);

        const objectVolumeM3 = objectVolumeCM3 / 1_000_000; // Convert cm³ to m³
        const displacedVolumeL = objectVolumeM3 * 1000; // 1 m³ = 1000 L
        const finalFluidVolumeL = initialFluidVolumeL + displacedVolumeL;

        document.getElementById('infoInitialFluidVolume').textContent = `${initialFluidVolumeL.toFixed(0)} L`;
        document.getElementById('infoObjectVolumeDisplacement').textContent = `${objectVolumeCM3.toFixed(0)} cm³`;
        document.getElementById('displacedVolume').textContent = `${displacedVolumeL.toFixed(3)} L`;
        document.getElementById('finalFluidVolume').textContent = `${finalFluidVolumeL.toFixed(3)} L`;

        // Update visual
        const fluidContainer = document.querySelector('#fluidDisplacement .fluid-container');
        const fluidLevelDiv = document.getElementById('displacementFluidLevel');
        const displacementObject = document.getElementById('displacementObject');

        const containerHeight = fluidContainer.offsetHeight;
        const containerWidth = fluidContainer.offsetWidth;

        // Scale initial fluid level based on initial volume
        const initialFluidHeightRatio = initialFluidVolumeL / 100; // Assuming max 100L for visual scale
        fluidLevelDiv.style.height = `${containerHeight * initialFluidHeightRatio}px`;

        // Object visual size (scaled for display)
        const objectVisualSize = Math.min(objectVolumeCM3 * 0.5, containerWidth * 0.4); // Scale cm³ to pixels
        displacementObject.style.width = `${objectVisualSize}px`;
        displacementObject.style.height = `${objectVisualSize}px`;
        displacementObject.style.left = `${(containerWidth - objectVisualSize) / 2}px`;
        displacementObject.style.bottom = `${containerHeight * initialFluidHeightRatio}px`; // Place at water level
        displacementObject.textContent = `${objectVolumeCM3.toFixed(0)} cm³`;

        // Animate fluid rise
        setTimeout(() => {
            const finalFluidHeightRatio = finalFluidVolumeL / 100;
            fluidLevelDiv.style.height = `${containerHeight * finalFluidHeightRatio}px`;
        }, 100); // Small delay for visual effect
      }
      // Density Calculator Info
      else if (currentTabMode === 'densityCalculator') {
        const mass = parseFloat(document.getElementById('massDensity').value);
        const volume = parseFloat(document.getElementById('volumeDensity').value);

        let density = 0;
        if (volume !== 0) {
          density = mass / volume;
        } else {
          density = Infinity; // Handle division by zero
        }

        document.getElementById('infoMassDensity').textContent = `${mass.toFixed(2)} kg`;
        document.getElementById('infoVolumeDensity').textContent = `${volume.toFixed(4)} m³`;
        document.getElementById('calculatedDensity').textContent = `${density.toFixed(2)} kg/m³`;
      }
      // Torricelli's Law Info
      else if (currentTabMode === 'torricelliLaw') {
        const fluidHeight = parseFloat(document.getElementById('fluidHeightTorricelli').value);
        const orificeAreaCM2 = parseFloat(document.getElementById('orificeAreaTorricelli').value);
        const orificeAreaM2 = orificeAreaCM2 / 10000; // Convert cm² to m²

        const effluxVelocity = Math.sqrt(2 * G * fluidHeight);
        const flowRate = effluxVelocity * orificeAreaM2; // Q = v * A

        document.getElementById('infoFluidHeightTorricelli').textContent = `${fluidHeight.toFixed(1)} m`;
        document.getElementById('effluxVelocity').textContent = `${effluxVelocity.toFixed(2)} m/s`;
        document.getElementById('flowRate').textContent = `${flowRate.toFixed(4)} m³/s`;

        // Update visual
        const torricelliTank = document.querySelector('.torricelli-tank');
        const torricelliFluidLevel = document.getElementById('torricelliFluidLevel');
        const torricelliStream = document.getElementById('torricelliStream');

        const tankHeight = torricelliTank.offsetHeight;
        const orificeBottom = 50; // Defined in CSS
        const fluidHeightPx = (fluidHeight / 5) * (tankHeight - orificeBottom); // Scale fluid height to tank visual (max 5m)
        torricelliFluidLevel.style.height = `${fluidHeightPx + orificeBottom}px`; // Fluid level includes space below orifice

        // Adjust stream length based on velocity
        const maxVelocity = Math.sqrt(2 * G * 5); // Max velocity for 5m height
        const streamLengthPx = (effluxVelocity / maxVelocity) * 200; // Max stream length 200px
        torricelliStream.style.height = `${streamLengthPx}px`;

        // Adjust stream width based on orifice area (visual only)
        const streamWidthPx = (orificeAreaCM2 / 100) * 20; // Max 20px for 100cm2
        torricelliStream.style.width = `${streamWidthPx}px`;
      }
    }

    // --- Tab Switching Functionality ---
    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        // Stop any ongoing animations if applicable (though these sims are mostly event-driven)
        cancelAnimationFrame(animationId);

        // Remove active class from all buttons and content
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));

        // Add active class to clicked button and corresponding content
        btn.classList.add('active');
        const tabId = btn.getAttribute('data-tab');
        document.getElementById(tabId).classList.add('active');

        // Update global mode
        currentTabMode = tabId;

        // Re-run info panel update for the newly active tab
        updateInfoPanel();
      });
    });

    // --- Buoyancy Simulation ---
    const objectMassBuoyancyInput = document.getElementById('objectMassBuoyancy');
    const objectVolumeBuoyancyInput = document.getElementById('objectVolumeBuoyancy');
    const fluidDensityBuoyancyInput = document.getElementById('fluidDensityBuoyancy');

    objectMassBuoyancyInput.addEventListener('input', updateInfoPanel);
    objectVolumeBuoyancyInput.addEventListener('input', updateInfoPanel);
    fluidDensityBuoyancyInput.addEventListener('input', updateInfoPanel);

    // --- Fluid Displacement Simulation ---
    const initialFluidVolumeInput = document.getElementById('initialFluidVolume');
    const objectVolumeDisplacementInput = document.getElementById('objectVolumeDisplacement');

    initialFluidVolumeInput.addEventListener('input', updateInfoPanel);
    objectVolumeDisplacementInput.addEventListener('input', updateInfoPanel);

    // --- Density Calculator ---
    const massDensityInput = document.getElementById('massDensity');
    const volumeDensityInput = document.getElementById('volumeDensity');

    massDensityInput.addEventListener('input', updateInfoPanel);
    volumeDensityInput.addEventListener('input', updateInfoPanel);

    // --- Torricelli's Law Simulator ---
    const fluidHeightTorricelliInput = document.getElementById('fluidHeightTorricelli');
    const orificeAreaTorricelliInput = document.getElementById('orificeAreaTorricelli');

    fluidHeightTorricelliInput.addEventListener('input', updateInfoPanel);
    orificeAreaTorricelliInput.addEventListener('input', updateInfoPanel);


    // Initial setup on DOMContentLoaded
    document.addEventListener('DOMContentLoaded', () => {
        // Find the initially active tab and set up its content
        const activeTabBtn = document.querySelector('.tab-btn.active');
        if (activeTabBtn) {
            const tabId = activeTabBtn.getAttribute('data-tab');
            currentTabMode = tabId; // Set initial mode
        }
        updateInfoPanel(); // Initial update of the info panel for the active tab
    });

  </script>
</body>
</html>